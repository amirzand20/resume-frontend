<app-header></app-header>

<div class="resume-builder-container">
  <p-toast position="bottom-left" styleClass="custom-toast"></p-toast>
  <div class="resume-builder-card">
    <div class="resume-builder-header">
      <h1>ساخت رزومه</h1>
      <p>لطفاً اطلاعات خود را وارد کنید و مراحل را تکمیل نمایید.</p>
    </div>

    <!-- Custom Stepper -->
    <div class="custom-stepper">
      <div class="step" [ngClass]="{'completed': currentStep > 0, 'current': currentStep === 0, 'pending': currentStep < 0}">
        <div class="circle"></div>
        <div class="step-label">اطلاعات شخصی</div>
        <div class="step-badge" *ngIf="currentStep > 0">تکمیل شد</div>
        <div class="step-badge" *ngIf="currentStep === 0">در حال انجام</div>
        <div class="step-badge" *ngIf="currentStep < 0">در انتظار</div>
      </div>
      <div class="step" [ngClass]="{'completed': currentStep > 1, 'current': currentStep === 1, 'pending': currentStep < 1}">
        <div class="circle"></div>
        <div class="step-label">تحصیلات</div>
        <div class="step-badge" *ngIf="currentStep > 1">تکمیل شد</div>
        <div class="step-badge" *ngIf="currentStep === 1">در حال انجام</div>
        <div class="step-badge" *ngIf="currentStep < 1">در انتظار</div>
      </div>
      <div class="step" [ngClass]="{'completed': currentStep > 2, 'current': currentStep === 2, 'pending': currentStep < 2}">
        <div class="circle"></div>
        <div class="step-label">مهارت‌ها</div>
        <div class="step-badge" *ngIf="currentStep > 2">تکمیل شد</div>
        <div class="step-badge" *ngIf="currentStep === 2">در حال انجام</div>
        <div class="step-badge" *ngIf="currentStep < 2">در انتظار</div>
      </div>
      <div class="step" [ngClass]="{'completed': currentStep > 3, 'current': currentStep === 3, 'pending': currentStep < 3}">
        <div class="circle"></div>
        <div class="step-label">تکمیل</div>
        <div class="step-badge" *ngIf="currentStep > 3">تکمیل شد</div>
        <div class="step-badge" *ngIf="currentStep === 3">در حال انجام</div>
        <div class="step-badge" *ngIf="currentStep < 3">در انتظار</div>
      </div>
    </div>

    <form [formGroup]="resumeForm" (ngSubmit)="onSubmit()" class="resume-form">
      <!-- Step 1: اطلاعات شخصی -->
      <div *ngIf="currentStep === 0" class="form-section">
        <div class="form-grid">
          <div class="form-group">
            <label for="nationalId">کد ملی</label>
            <input id="nationalId" type="text" pInputText formControlName="nationalId" />
            <div class="error-message" *ngIf="resumeForm.get('nationalId')?.errors?.['required'] && resumeForm.get('nationalId')?.touched">
              کد ملی الزامی است
            </div>
            <div class="error-message" *ngIf="resumeForm.get('nationalId')?.errors?.['pattern'] && resumeForm.get('nationalId')?.touched">
              کد ملی باید ۱۰ رقم باشد
            </div>
          </div>
          <div class="form-group">
            <label for="firstName">نام</label>
            <input id="firstName" type="text" pInputText formControlName="firstName" />
            <div class="error-message" *ngIf="resumeForm.get('firstName')?.errors?.['required'] && resumeForm.get('firstName')?.touched">
              نام الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="lastName">نام خانوادگی</label>
            <input id="lastName" type="text" pInputText formControlName="lastName" />
            <div class="error-message" *ngIf="resumeForm.get('lastName')?.errors?.['required'] && resumeForm.get('lastName')?.touched">
              نام خانوادگی الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="fatherName">نام پدر</label>
            <input id="fatherName" type="text" pInputText formControlName="fatherName" />
            <div class="error-message" *ngIf="resumeForm.get('fatherName')?.errors?.['required'] && resumeForm.get('fatherName')?.touched">
              نام پدر الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="birthDate">تاریخ تولد</label>
            <p-calendar id="birthDate" formControlName="birthDate" [locale]="calendarConfig.locale" [dateFormat]="calendarConfig.dateFormat" [showIcon]="calendarConfig.showIcon" [showButtonBar]="calendarConfig.showButtonBar" [firstDayOfWeek]="calendarConfig.firstDayOfWeek" [showWeek]="calendarConfig.showWeek" [showOtherMonths]="calendarConfig.showOtherMonths" [selectOtherMonths]="calendarConfig.selectOtherMonths" [yearRange]="calendarConfig.yearRange"></p-calendar>
            <div class="error-message" *ngIf="resumeForm.get('birthDate')?.errors?.['required'] && resumeForm.get('birthDate')?.touched">
              تاریخ تولد الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="birthCity">شهر محل تولد</label>
            <input id="birthCity" type="text" pInputText formControlName="birthCity" />
            <div class="error-message" *ngIf="resumeForm.get('birthCity')?.errors?.['required'] && resumeForm.get('birthCity')?.touched">
              شهر محل تولد الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="currentCity">شهر محل سکونت</label>
            <input id="currentCity" type="text" pInputText formControlName="currentCity" />
            <div class="error-message" *ngIf="resumeForm.get('currentCity')?.errors?.['required'] && resumeForm.get('currentCity')?.touched">
              شهر محل سکونت الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="phone">شماره موبایل</label>
            <input id="phone" type="tel" pInputText formControlName="phone" />
            <div class="error-message" *ngIf="resumeForm.get('phone')?.errors?.['required'] && resumeForm.get('phone')?.touched">
              شماره موبایل الزامی است
            </div>
            <div class="error-message" *ngIf="resumeForm.get('phone')?.errors?.['pattern'] && resumeForm.get('phone')?.touched">
              شماره موبایل باید ۱۱ رقم باشد
            </div>
          </div>
          <div class="form-group">
            <label for="email">ایمیل</label>
            <input id="email" type="email" pInputText formControlName="email" />
            <div class="error-message" *ngIf="resumeForm.get('email')?.errors?.['required'] && resumeForm.get('email')?.touched">
              ایمیل الزامی است
            </div>
            <div class="error-message" *ngIf="resumeForm.get('email')?.errors?.['email'] && resumeForm.get('email')?.touched">
              ایمیل معتبر نیست
            </div>
          </div>
          <div class="form-group">
            <label for="address">آدرس</label>
            <input id="address" type="text" pInputText formControlName="address" />
            <div class="error-message" *ngIf="resumeForm.get('address')?.errors?.['required'] && resumeForm.get('address')?.touched">
              آدرس الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="profileImage">عکس پروفایل</label>
            <input id="profileImage" type="file" (change)="onFileSelected($event)" accept="image/*" />
          </div>
        </div>
      </div>

      <!-- Step 2: اطلاعات تحصیلی -->
      <div *ngIf="currentStep === 1" class="form-section">
        <div class="section-header">
          <h2>تحصیلات</h2>
          <button type="button" pButton icon="pi pi-plus" label="افزودن تحصیلات" (click)="addEducation()" class="p-button-outlined"></button>
        </div>
        <div formArrayName="education" *ngFor="let edu of educationFormArray.controls; let i = index" [formGroupName]="i" class="education-item">
          <div class="form-grid">
            <div class="form-group">
              <label>مقطع تحصیلی</label>
              <p-dropdown [options]="educationLevels" formControlName="degree" optionLabel="label" optionValue="value"></p-dropdown>
            </div>
            <div class="form-group">
              <label>رشته تحصیلی</label>
              <input type="text" pInputText formControlName="field" />
            </div>
            <div class="form-group">
              <label>دانشگاه</label>
              <input type="text" pInputText formControlName="university" />
            </div>
            <div class="form-group">
              <label>معدل</label>
              <p-inputNumber formControlName="gpa" [min]="0" [max]="20" [showButtons]="true"></p-inputNumber>
            </div>
            <div class="form-group">
              <label>تاریخ شروع</label>
              <p-calendar formControlName="startDate" [locale]="calendarConfig.locale" [dateFormat]="calendarConfig.dateFormat" [showIcon]="calendarConfig.showIcon" [showButtonBar]="calendarConfig.showButtonBar" [firstDayOfWeek]="calendarConfig.firstDayOfWeek" [showWeek]="calendarConfig.showWeek" [showOtherMonths]="calendarConfig.showOtherMonths" [selectOtherMonths]="calendarConfig.selectOtherMonths" [yearRange]="calendarConfig.yearRange"></p-calendar>
            </div>
            <div class="form-group">
              <label>تاریخ پایان</label>
              <p-calendar formControlName="endDate" [locale]="calendarConfig.locale" [dateFormat]="calendarConfig.dateFormat" [showIcon]="calendarConfig.showIcon" [showButtonBar]="calendarConfig.showButtonBar" [firstDayOfWeek]="calendarConfig.firstDayOfWeek" [showWeek]="calendarConfig.showWeek" [showOtherMonths]="calendarConfig.showOtherMonths" [selectOtherMonths]="calendarConfig.selectOtherMonths" [yearRange]="calendarConfig.yearRange"></p-calendar>
            </div>
          </div>
          <div class="form-group">
            <label>توضیحات</label>
            <textarea pInputTextarea formControlName="description" [rows]="3"></textarea>
          </div>
          <button type="button" pButton icon="pi pi-trash" label="حذف" (click)="removeEducation(i)" class="p-button-danger p-button-outlined"></button>
        </div>
      </div>

      <!-- Step 3: مهارت‌ها -->
      <div *ngIf="currentStep === 2" class="form-section">
        <div class="section-header">
          <h2>مهارت‌ها</h2>
          <button type="button" pButton icon="pi pi-plus" label="افزودن مهارت" (click)="addSkill()" class="p-button-outlined"></button>
        </div>
        <div formArrayName="skills" *ngFor="let skill of skillsFormArray.controls; let i = index" [formGroupName]="i" class="skill-item">
          <div class="form-grid">
            <div class="form-group">
              <label>نام مهارت</label>
              <input type="text" pInputText formControlName="name" />
            </div>
            <div class="form-group">
              <label>سطح مهارت</label>
              <p-dropdown [options]="skillLevels" formControlName="level" optionLabel="label" optionValue="value"></p-dropdown>
            </div>
          </div>
          <button type="button" pButton icon="pi pi-trash" label="حذف" (click)="removeSkill(i)" class="p-button-danger p-button-outlined"></button>
        </div>
      </div>

      <!-- Step 4: تکمیل -->
      <div *ngIf="currentStep === 3" class="form-section">
        <h2>تکمیل رزومه</h2>
        <p>لطفاً اطلاعات وارد شده را بررسی کنید و در صورت صحت، رزومه را ثبت کنید.</p>
      </div>

      <!-- Navigation Buttons -->
      <div class="action-buttons">
        <button *ngIf="currentStep > 0" type="button" pButton label="قبلی" icon="pi pi-arrow-right" (click)="prevStep()" class="p-button-secondary"></button>
        <button *ngIf="currentStep < 3" type="button" pButton label="بعدی" icon="pi pi-arrow-left" (click)="nextStep()" class="p-button-primary"></button>
        <button *ngIf="currentStep === 3" type="submit" pButton label="ثبت رزومه" icon="pi pi-save" class="p-button-success"></button>
      </div>
    </form>
  </div>
</div> 