<app-header></app-header>

<div class="resume-builder-container">
  <p-toast position="bottom-left" styleClass="custom-toast"></p-toast>

  <!-- Stepper Section -->
  <div class="stepper-section">
    <div class="custom-stepper-container">
      <div class="stepper-header">
        <h1>ساخت رزومه</h1>
        <p>لطفاً اطلاعات خود را وارد کنید و مراحل را تکمیل نمایید.</p>
      </div>
      <div class="custom-stepper">
        <div class="step"
          [ngClass]="{'completed': currentStep > 0, 'current': currentStep === 0, 'pending': currentStep < 0}">
          <div class="circle"></div>
          <div class="step-label">اطلاعات شخصی</div>
          <div class="step-badge" *ngIf="currentStep > 0">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 0">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 0">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 1, 'current': currentStep === 1, 'pending': currentStep < 1}">
          <div class="circle"></div>
          <div class="step-label">اطلاعات تماس</div>
          <div class="step-badge" *ngIf="currentStep > 0">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 0">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 0">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 2, 'current': currentStep === 2, 'pending': currentStep < 2}">
          <div class="circle"></div>
          <div class="step-label">تحصیلات</div>
          <div class="step-badge" *ngIf="currentStep > 1">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 1">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 1">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 3, 'current': currentStep === 3, 'pending': currentStep < 3}">
          <div class="circle"></div>
          <div class="step-label">سوابق کاری</div>
          <div class="step-badge" *ngIf="currentStep > 2">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 2">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 2">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 4, 'current': currentStep === 4, 'pending': currentStep < 4}">
          <div class="circle"></div>
          <div class="step-label">مهارت‌ها</div>
          <div class="step-badge" *ngIf="currentStep > 3">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 3">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 3">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 5, 'current': currentStep === 5, 'pending': currentStep < 5}">
          <div class="circle"></div>
          <div class="step-label">زبان‌ها</div>
          <div class="step-badge" *ngIf="currentStep > 4">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 4">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 4">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 6, 'current': currentStep === 6, 'pending': currentStep < 6}">
          <div class="circle"></div>
          <div class="step-label">دوره‌های آموزشی</div>
          <div class="step-badge" *ngIf="currentStep > 5">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 5">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 5">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 7, 'current': currentStep === 7, 'pending': currentStep < 7}">
          <div class="circle"></div>
          <div class="step-label">افتخارات</div>
          <div class="step-badge" *ngIf="currentStep > 6">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 6">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 6">در انتظار</div>
        </div>
        <div class="step"
          [ngClass]="{'completed': currentStep > 8, 'current': currentStep === 8, 'pending': currentStep < 8}">
          <div class="circle"></div>
          <div class="step-label">تکمیل</div>
          <div class="step-badge" *ngIf="currentStep > 7">تکمیل شد</div>
          <div class="step-badge" *ngIf="currentStep === 7">در حال انجام</div>
          <div class="step-badge" *ngIf="currentStep < 7">در انتظار</div>
        </div>
      </div>
    </div>
  </div>

  <div class="resume-builder-card">
    <form [formGroup]="resumeForm" (ngSubmit)="onSubmit()" class="resume-form">
      <!-- Step 1: اطلاعات شخصی -->
      <div *ngIf="currentStep === 0" class="form-section">
        <div class="form-grid">
          <div class="form-group">
            <label for="nationalNo">کد ملی</label>
            <input id="nationalNo" type="text" pInputText formControlName="nationalNo" />
            <div class="error-message"
              *ngIf="resumeForm.get('nationalNo')?.errors?.['required'] && resumeForm.get('nationalNo')?.touched">
              کد ملی الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('nationalNo')?.errors?.['pattern'] && resumeForm.get('nationalNo')?.touched">
              کد ملی باید ۱۰ رقم باشد
            </div>
          </div>
          <div class="form-group">
            <label for="firstName">نام</label>
            <input id="firstName" type="text" pInputText formControlName="firstName" />
            <div class="error-message"
              *ngIf="resumeForm.get('firstName')?.errors?.['required'] && resumeForm.get('firstName')?.touched">
              نام الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="lastName">نام خانوادگی</label>
            <input id="lastName" type="text" pInputText formControlName="lastName" />
            <div class="error-message"
              *ngIf="resumeForm.get('lastName')?.errors?.['required'] && resumeForm.get('lastName')?.touched">
              نام خانوادگی الزامی است
            </div>
          </div>
          <div class="form-group">
            <label>جنسیت</label>
            <p-dropdown [options]="sex" formControlName="sexId" optionLabel="label" optionValue="value"></p-dropdown>
          </div>
          <div class="form-group">
            <label for="fatherName">نام پدر</label>
            <input id="fatherName" type="text" pInputText formControlName="fatherName" />
            <div class="error-message"
              *ngIf="resumeForm.get('fatherName')?.errors?.['required'] && resumeForm.get('fatherName')?.touched">
              نام پدر الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="birthDate">تاریخ تولد</label>
            <!-- <p-calendar id="birthDate" formControlName="birthDate" [locale]="calendarConfig.locale" [dateFormat]="calendarConfig.dateFormat" [showIcon]="calendarConfig.showIcon" [showButtonBar]="calendarConfig.showButtonBar" [firstDayOfWeek]="calendarConfig.firstDayOfWeek" [showWeek]="calendarConfig.showWeek" [showOtherMonths]="calendarConfig.showOtherMonths" [selectOtherMonths]="calendarConfig.selectOtherMonths" [yearRange]="calendarConfig.yearRange"></p-calendar> -->
            <aja-persian-date-picker formControlName="birthDate"></aja-persian-date-picker>
            <div class="error-message"
              *ngIf="resumeForm.get('birthDate')?.errors?.['required'] && resumeForm.get('birthDate')?.touched">
              تاریخ تولد الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="birthPlaceId">شهر محل تولد</label>
            <input id="birthPlaceId" type="text" pInputText formControlName="birthPlaceId" />
            <div class="error-message"
              *ngIf="resumeForm.get('birthPlaceId')?.errors?.['required'] && resumeForm.get('birthPlaceId')?.touched">
              شهر محل تولد الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="locationPlaceId">شهر محل سکونت</label>
            <input id="locationPlaceId" type="text" pInputText formControlName="locationPlaceId" />
            <div class="error-message"
              *ngIf="resumeForm.get('locationPlaceId')?.errors?.['required'] && resumeForm.get('locationPlaceId')?.touched">
              شهر محل سکونت الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="mobileNumber">شماره موبایل</label>
            <input id="mobileNumber" type="tel" pInputText formControlName="mobileNumber" />
            <div class="error-message"
              *ngIf="resumeForm.get('mobileNumber')?.errors?.['required'] && resumeForm.get('mobileNumber')?.touched">
              شماره موبایل الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('mobileNumber')?.errors?.['pattern'] && resumeForm.get('mobileNumber')?.touched">
              شماره موبایل باید ۱۱ رقم باشد
            </div>
          </div>
          <div class="form-group">
            <label for="telephoneNumber">تلفن</label>
            <input id="telephoneNumber" type="tel" pInputText formControlName="telephoneNumber" />
            <div class="error-message"
              *ngIf="resumeForm.get('telephoneNumber')?.errors?.['required'] && resumeForm.get('telephoneNumber')?.touched">
              تلفن الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('telephoneNumber')?.errors?.['pattern'] && resumeForm.get('telephoneNumber')?.touched">
              تلفن باید ۱۱ رقم و با پیش شماره باشد
            </div>
          </div>
          <div class="form-group">
            <label for="emailAddress">ایمیل</label>
            <input id="emailAddress" type="emailAddress" pInputText formControlName="emailAddress" />
            <div class="error-message"
              *ngIf="resumeForm.get('emailAddress')?.errors?.['required'] && resumeForm.get('emailAddress')?.touched">
              ایمیل الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('emailAddress')?.errors?.['emailAddress'] && resumeForm.get('emailAddress')?.touched">
              ایمیل معتبر نیست
            </div>
          </div>
          <div class="form-group">
            <label for="address">آدرس</label>
            <input id="address" type="text" pInputText formControlName="address" />
            <div class="error-message"
              *ngIf="resumeForm.get('address')?.errors?.['required'] && resumeForm.get('address')?.touched">
              آدرس الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="postCode">کدپستی</label>
            <input id="postCode" type="text" pInputText formControlName="postCode" />
            <div class="error-message"
              *ngIf="resumeForm.get('postCode')?.errors?.['required'] && resumeForm.get('postCode')?.touched">
              کدپستی الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="profileImage">عکس پروفایل</label>
            <input id="profileImage" type="file" (change)="onFileSelected($event)" accept="image/*" />
          </div>
        </div>
      </div>

      <!-- Step 2: اطلاعات تماس -->
      <div *ngIf="currentStep === 1" class="form-section" [formGroupName]="'contract'">
        <div class="form-grid">
          <div class="form-group">
            <label for="locationPlaceId">شهر محل سکونت</label>
            <input id="locationPlaceId" type="text" pInputText formControlName="locationPlaceId" />
            <div class="error-message"
              *ngIf="contractFormArray.get('locationPlaceId')?.errors?.['required'] && contractFormArray.get('locationPlaceId')?.touched">
              شهر محل سکونت الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="locationAddress">شهر محل سکونت</label>
            <input id="locationAddress" type="text" pInputText formControlName="locationAddress" />
            <div class="error-message"
              *ngIf="resumeForm.get('locationAddress')?.errors?.['required'] && resumeForm.get('locationAddress')?.touched">
              شهر محل سکونت الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="mobileNumber">شماره موبایل</label>
            <input id="mobileNumber" type="tel" pInputText formControlName="mobileNumber" />
            <div class="error-message"
              *ngIf="resumeForm.get('mobileNumber')?.errors?.['required'] && resumeForm.get('mobileNumber')?.touched">
              شماره موبایل الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('mobileNumber')?.errors?.['pattern'] && resumeForm.get('mobileNumber')?.touched">
              شماره موبایل باید ۱۱ رقم باشد
            </div>
          </div>
          <div class="form-group">
            <label for="telephoneNumber">تلفن</label>
            <input id="telephoneNumber" type="tel" pInputText formControlName="telephoneNumber" />
            <div class="error-message"
              *ngIf="resumeForm.get('telephoneNumber')?.errors?.['required'] && resumeForm.get('telephoneNumber')?.touched">
              تلفن الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('telephoneNumber')?.errors?.['pattern'] && resumeForm.get('telephoneNumber')?.touched">
              تلفن باید ۱۱ رقم و با پیش شماره باشد
            </div>
          </div>
          <div class="form-group">
            <label for="postCode">کدپستی</label>
            <input id="postCode" type="text" pInputText formControlName="postCode" />
            <div class="error-message"
              *ngIf="resumeForm.get('postCode')?.errors?.['required'] && resumeForm.get('postCode')?.touched">
              کدپستی الزامی است
            </div>
          </div>
          <div class="form-group">
            <label for="fatherMobileNumber">شماره موبایل پدر</label>
            <input id="fatherMobileNumber" type="tel" pInputText formControlName="fatherMobileNumber" />
            <div class="error-message"
              *ngIf="resumeForm.get('fatherMobileNumber')?.errors?.['required'] && resumeForm.get('fatherMobileNumber')?.touched">
              شماره موبایل الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('fatherMobileNumber')?.errors?.['pattern'] && resumeForm.get('fatherMobileNumber')?.touched">
              شماره موبایل باید ۱۱ رقم باشد
            </div>
          </div>
          <div class="form-group">
            <label for="motherMobileNumber">شماره موبایل مادر</label>
            <input id="motherMobileNumber" type="tel" pInputText formControlName="motherMobileNumber" />
            <div class="error-message"
              *ngIf="resumeForm.get('motherMobileNumber')?.errors?.['required'] && resumeForm.get('motherMobileNumber')?.touched">
              شماره موبایل الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('motherMobileNumber')?.errors?.['pattern'] && resumeForm.get('motherMobileNumber')?.touched">
              شماره موبایل باید ۱۱ رقم باشد
            </div>
          </div>
          <div class="form-group">
            <label for="emailAddress">ایمیل</label>
            <input id="emailAddress" type="emailAddress" pInputText formControlName="emailAddress" />
            <div class="error-message"
              *ngIf="resumeForm.get('emailAddress')?.errors?.['required'] && resumeForm.get('emailAddress')?.touched">
              ایمیل الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('emailAddress')?.errors?.['emailAddress'] && resumeForm.get('emailAddress')?.touched">
              ایمیل معتبر نیست
            </div>
          </div>
          <div class="form-group">
            <label for="familiarMobileNumber">شماره موبایل آشنا</label>
            <input id="familiarMobileNumber" type="tel" pInputText formControlName="familiarMobileNumber" />
            <div class="error-message"
              *ngIf="resumeForm.get('familiarMobileNumber')?.errors?.['required'] && resumeForm.get('familiarMobileNumber')?.touched">
              شماره موبایل الزامی است
            </div>
            <div class="error-message"
              *ngIf="resumeForm.get('familiarMobileNumber')?.errors?.['pattern'] && resumeForm.get('familiarMobileNumber')?.touched">
              شماره موبایل باید ۱۱ رقم باشد
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: اطلاعات تحصیلی -->
      <div *ngIf="currentStep === 2" class="form-section">
        <div class="section-header">
          <h2>تحصیلات</h2>
          <button type="button" pButton icon="pi pi-plus" label="افزودن تحصیلات" (click)="addEducation()"
            class="p-button-info p-button-outlined"></button>
        </div>
        <div formArrayName="education" *ngFor="let edu of educationFormArray.controls; let i = index"
          [formGroupName]="i" class="education-item">
          <div class="form-grid">
            <div class="form-group">
              <label>مقطع تحصیلی</label>
              <p-dropdown [options]="educationLevels" formControlName="degree" optionLabel="label"
                optionValue="value"></p-dropdown>
            </div>
            <div class="form-group">
              <label>رشته تحصیلی</label>
              <input type="text" pInputText formControlName="field" />
            </div>
            <div class="form-group">
              <label>دانشگاه</label>
              <input type="text" pInputText formControlName="university" />
            </div>
            <div class="form-group">
              <label>معدل</label>
              <p-inputNumber formControlName="gpa" [min]="0" [max]="20" [showButtons]="true"></p-inputNumber>
            </div>
            <div class="form-group">
              <label>تاریخ شروع</label>
              <!-- <p-calendar formControlName="startDate" [locale]="calendarConfig.locale" [dateFormat]="calendarConfig.dateFormat" [showIcon]="calendarConfig.showIcon" [showButtonBar]="calendarConfig.showButtonBar" [firstDayOfWeek]="calendarConfig.firstDayOfWeek" [showWeek]="calendarConfig.showWeek" [showOtherMonths]="calendarConfig.showOtherMonths" [selectOtherMonths]="calendarConfig.selectOtherMonths" [yearRange]="calendarConfig.yearRange"></p-calendar> -->
              <aja-persian-date-picker formControlName="startDate"></aja-persian-date-picker>
            </div>
            <div class="form-group">
              <label>تاریخ پایان</label>
              <aja-persian-date-picker formControlName="endDate"></aja-persian-date-picker>
              <!-- <p-calendar formControlName="endDate" [locale]="calendarConfig.locale" [dateFormat]="calendarConfig.dateFormat" [showIcon]="calendarConfig.showIcon" [showButtonBar]="calendarConfig.showButtonBar" [firstDayOfWeek]="calendarConfig.firstDayOfWeek" [showWeek]="calendarConfig.showWeek" [showOtherMonths]="calendarConfig.showOtherMonths" [selectOtherMonths]="calendarConfig.selectOtherMonths" [yearRange]="calendarConfig.yearRange"></p-calendar> -->
            </div>
          </div>
          <div class="form-group">
            <label>توضیحات</label>
            <textarea pInputTextarea formControlName="description" [rows]="3"></textarea>
          </div>
          <button type="button" pButton icon="pi pi-trash" label="حذف" (click)="removeEducation(i)"
            class="p-button-danger p-button-outlined"></button>
        </div>
      </div>

      <!-- Step 4: مهارت‌ها -->
      <div *ngIf="currentStep === 3" class="form-section">
        <div class="section-header">
          <h2>مهارت‌ها</h2>
          <button type="button" pButton icon="pi pi-plus" label="افزودن مهارت" (click)="addSkill()"
            class="p-button-outlined p-button-info"></button>
        </div>
        <div formArrayName="skills" *ngFor="let skill of skillsFormArray.controls; let i = index" [formGroupName]="i"
          class="skill-item">
          <div class="form-grid">
            <div class="form-group">
              <label>نام مهارت</label>
              <input type="text" pInputText formControlName="name" />
            </div>
            <div class="form-group">
              <label>سطح مهارت</label>
              <p-dropdown [options]="skillLevels" formControlName="level" optionLabel="label"
                optionValue="value"></p-dropdown>
            </div>
          </div>
          <button type="button" pButton icon="pi pi-trash" label="حذف" (click)="removeSkill(i)"
            class="p-button-danger p-button-outlined"></button>
        </div>
      </div>

      <!-- Step 5: تکمیل -->
      <div *ngIf="currentStep === 4" class="form-section">
        <h2>تکمیل رزومه</h2>
        <p>لطفاً اطلاعات وارد شده را بررسی کنید و در صورت صحت، رزومه را ثبت کنید.</p>
      </div>

      <!-- Navigation Buttons -->
      <div class="action-buttons">
        <button *ngIf="currentStep < 7" type="button" pButton label="بعدی" icon="pi pi-arrow-left" (click)="nextStep()"
          class="p-button-primary"></button>
        <button *ngIf="currentStep > 0" type="button" pButton label="قبلی" icon="pi pi-arrow-right" (click)="prevStep()"
          class="p-button-primary"></button>
        <button *ngIf="currentStep === 7" type="submit" pButton label="ثبت رزومه" icon="pi pi-save"
          class="p-button-success"></button>
      </div>
    </form>
  </div>
</div>